# Votechain Ballot

Encrypted MVP rating system inspired by the [votechain-ballot-box UI](https://github.com/PatriciaLawson33/votechain-ballot-box) and powered by Zama's FHEVM.
Fans can rate players from 1-11 points with private encrypted votes, tally owners can decrypt locally, and the RainbowKit wallet surface keeps onboarding lightweight.

## Highlights

- **`EncryptedMvpVoting.sol`** aggregates encrypted 1-11 point ratings per player and stores decrypted tally metadata.
- **RainbowKit + wagmi** integration with a custom neon-themed UI and brand assets (logo + favicon).
- **FHE-friendly hooks** (`useEncryptedMvpVoting`, `useRainbowSigner`) encapsulate encryption, decryption and contract reads/writes.
- **End-to-end tests** (`EncryptedMvpVoting.ts`, `EncryptedMvpVotingSepolia.ts`) prove the encrypted flow locally and against Sepolia.

## Repository layout

```
votechain-ballot/
‚îú‚îÄ‚îÄ contracts/EncryptedMvpVoting.sol   # Core contract
‚îú‚îÄ‚îÄ deploy/deploy.ts                   # Hardhat-deploy script (seeds 3 starters)
‚îú‚îÄ‚îÄ test/                              # Local + Sepolia specs
‚îú‚îÄ‚îÄ frontend/                          # Next.js app with RainbowKit UI
‚îÇ   ‚îú‚îÄ‚îÄ hooks/useEncryptedMvpVoting.ts # Contract/FHE orchestrator
‚îÇ   ‚îú‚îÄ‚îÄ components/TopNav.tsx          # Logo + Connect button
‚îÇ   ‚îî‚îÄ‚îÄ public/votechain-icon.svg      # Brand assets
‚îî‚îÄ‚îÄ README.md                          # (You are here)
```

## Prerequisites

- Node.js ‚â• 20
- npm
- Python (only needed if you want to regenerate the PNG favicon)

## Backend workflow

   ```bash
cd votechain-ballot
npm install

# Compile & typegen
npm run compile

# Run hardhat unit tests (mock FHE VM)
npm run test

# Configure Sepolia credentials once (addresses injected via hardhat-vars)
npx hardhat vars set PRIVATE_KEY      # paste the deployer key used in MetaMask
npx hardhat vars set SEPOLIA_RPC_URL  # optional custom RPC, defaults to Infura

# (Optional) start a local FHE-ready node & deploy
npx hardhat node            # terminal A
npx hardhat deploy --network localhost --reset   # terminal B

# (Optional) Sepolia deployment
npx hardhat deploy --network sepolia
npx hardhat test --network sepolia
```

Custom tasks (see `tasks/EncryptedMvpVoting.ts`):

- `npx hardhat task:list-players`
- `npx hardhat task:vote --player 0 --weight 1`
- `npx hardhat task:decrypt-player --player 0`

## Frontend workflow

   ```bash
cd frontend
npm install
npm run genabi       # pulls ABI & addresses from ../deployments
npm run dev          # http://localhost:3000
   ```

UI acceptance checklist:

- RainbowKit connect button fixed in the top-right corner.
- Hero section + cards match the neon/spatial layout from votechain-ballot-box (adjusted for Next.js).
- Player cards trigger: encrypted vote, local decrypt (FHE signature), oracle request.
- All copy, tooltips and docs are in **English**, per requirements.
- RainbowKit locale is forced to `en-US` to prevent Chinese prompts when browser language changes.

## Brand updates

- `frontend/public/votechain-icon.svg` ‚Äì new logomark for the navbar.
- `frontend/app/icon.png` ‚Äì generated favicon/browser icon.

## Testing & linting

- Smart contracts: `npm run test`
- Frontend lint: `cd frontend && npm run lint`

## Deployment tips

- Always run `npm run genabi` inside `frontend/` after redeploying contracts.
- Set `NEXT_PUBLIC_WALLETCONNECT_ID` and `NEXT_PUBLIC_SEPOLIA_RPC` for production builds.

### Dynamic contract addresses

The frontend supports dynamic contract address configuration via environment variables. This allows overriding the static addresses generated by `genabi`.

‚ö†Ô∏è **Important**: Always ensure your wallet network matches the contract network. The frontend will show an error if you try to interact with a contract on a different network than your wallet is connected to.

Create a `.env.local` file in the `frontend/` directory:

   ```bash
# Wallet Connect Configuration
NEXT_PUBLIC_WALLETCONNECT_ID=your_walletconnect_project_id_here

# Sepolia RPC Configuration (optional, defaults to Infura)
NEXT_PUBLIC_SEPOLIA_RPC=https://sepolia.infura.io/v3/your_infura_key_here
NEXT_PUBLIC_INFURA_ID=your_infura_project_id_here

# Dynamic Contract Address Configuration
# These override the static addresses from EncryptedMvpVotingAddresses.ts

# Localhost (Hardhat) contract address
NEXT_PUBLIC_CONTRACT_ADDRESS_LOCALHOST=0x5FbDB2315678afecb367f032d93F642f64180aa3

# Sepolia contract address (set after deployment)
NEXT_PUBLIC_CONTRACT_ADDRESS_SEPOLIA=0x0000000000000000000000000000000000000000

# Custom network example
# NEXT_PUBLIC_CONTRACT_ADDRESS_12345=0xabcdefabcdefabcdefabcdefabcdefabcdefabcd
```

If not set, the frontend falls back to addresses from `EncryptedMvpVotingAddresses.ts` (generated by `npm run genabi`).

### Network configuration mismatch

**Symptom**: "Network mismatch! Contract is on [network] but wallet is on [network]"

**Causes**:
- Wallet connected to different network than contract deployment
- Environment variables point to wrong network contracts
- Static configuration not updated after network switch

**Solutions**:

1. **Check wallet network**:
   - Click network dropdown in MetaMask
   - Switch to the network where your contract is deployed
   - For localhost development: use "Localhost 8545"
   - For testnet: use "Sepolia"

2. **Update environment variables**:
   ```bash
   # For localhost development
   NEXT_PUBLIC_CONTRACT_ADDRESS_LOCALHOST=0x5FbDB2315678afecb367f032d93F642f64180aa3

   # For Sepolia testnet (update after deployment)
   NEXT_PUBLIC_CONTRACT_ADDRESS_SEPOLIA=0x0000000000000000000000000000000000000000
   ```

3. **Regenerate ABI after deployment**:
   ```bash
   cd frontend
   npm run genabi
   ```

- For Sepolia oracle decryptions, wait for the KMS callback after calling `requestOnchainDecryption`.

Enjoy secure MVP voting! üèÄüõ°Ô∏è
